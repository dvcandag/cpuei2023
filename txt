cpuei2023/
│
├── database/
│   ├── foto-alumno/
│   ├── qr-alumno/
│   └── cpuei2023.sql
├── config/
│   ├── config.php
│   └── database.php│ 
├── public/
│   ├── js/
│   │   ├── script_home.js
│   │   ├── script_navbar.js
│   │   ├── script_login.js
│   │   ├── script_login.js
│   │   ├── script_mostrar_formulario_matricula.js
│   │   ├── slider-dashboard.js
│   │   ├── 
│   │   └── script_navegacion.js
│   └── css/
│       ├── styles_home.css
│       └── styles_navbar.css
│
│
├── controllers/
│   ├── DashboardController.php
│   ├── New_PasswordController.php
│   ├── CursosController.php
│   ├── HeaderController.php
│   ├── LoginController.php
│   ├── HorarioAlumnoController.php
│   ├── PagosController.php
│   ├── MatriculaController.php
│   └── CarnetAlumnoController.php
│
├── models/
│   ├── LoginModel.php
│   ├── DashboardModel.php
│   ├── New_PasswordModel.php
│   ├── HorarioAlumnoModel.php
│   ├── HeaderModel.php
│   ├── RegistroAccesoModel.PHP
│   ├── CursosModel.php
│   ├── PagosModel.php
│   ├── MatriculaModel.php
│   └── CarnetAlumnoModel.php
│
├── views/
│   ├── template/
│   │   ├── footer.php
│   │   ├── qr_alumno.php
│   │   ├── header.php
│   │   └── navbar.php
│   ├── dashboard.php
│   ├── login.php
│   ├── logout.php
│   ├── home.php
│   ├── CursosView.php
│   ├── nuevo_password.php
│   ├── carnet-alumno.php
│   ├── HorarioAlumnoView.php
│   ├── PagosView.php
│   ├── MatriculaView.php
│   └── registrate.php
│
│
└── index.php

 



--
-- Base de datos: `cpuei2023`
--

DELIMITER $$
--
-- Funciones
--
CREATE DEFINER=`root`@`localhost` FUNCTION `calcular_promedio_ponderado` (`n1` DECIMAL(5,2), `n2` DECIMAL(5,2), `n3` DECIMAL(5,2), `n4` DECIMAL(5,2), `np` DECIMAL(5,2)) RETURNS DECIMAL(5,2) DETERMINISTIC BEGIN
    RETURN (n1*0.05 + n2*0.20 + n3*0.20 + n4*0.15 + np*0.40);
END$$

DELIMITER ;



CREATE TABLE `alumno` (
  `codalumno` char(8) NOT NULL,
  `nombrealumno` varchar(250) NOT NULL,
  `apaterno` varchar(250) NOT NULL,
  `amaterno` varchar(250) NOT NULL,
  `dni` char(8) NOT NULL,
  `fecha_nacimiento` date NOT NULL,
  `fotoalumno` blob DEFAULT NULL,
  `correo` varchar(250) NOT NULL,
  `escuela_nombre` varchar(250) NOT NULL,
  `codAula` char(8) DEFAULT NULL,
  `codSede` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `alumno_horario` (
  `codalumno` char(8) NOT NULL,
  `codhorario` char(8) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `aula_laboratorio` (
  `codAula` char(8) NOT NULL,
  `nombreAula` varchar(50) NOT NULL,
  `tipo` enum('Aula','Laboratorio','Sala de conferencias','Sala de música','Taller','Auditorio') NOT NULL,
  `capacidad` int(11) NOT NULL,
  `codSede` int(11) NOT NULL,
  `equipamiento` text DEFAULT NULL,
  `estado` enum('Disponible','En mantenimiento','Clausurado','Fuera de servicio') DEFAULT 'Disponible'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `ciclo` (
  `codCiclo` char(8) NOT NULL,
  `cicloNombre` enum('I','II','III','IV','V','VI','VII','VIII','IX','X') NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `curso` (
  `codcurso` char(8) NOT NULL,
  `nombrecurso` varchar(250) NOT NULL,
  `descripcion` varchar(500) DEFAULT NULL,
  `creditos` int(11) NOT NULL,
  `hora_semanal` int(10) DEFAULT NULL,
  `codprofesor` char(8) DEFAULT NULL,
  `codPeriodo` int(11) DEFAULT NULL,
  `modalidad` enum('Presencial','Semi-presencial','Virtual') NOT NULL,
  `estado` enum('activo','inactivo') DEFAULT 'activo'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `horarios_disponibles` (
  `codhorario` char(8) NOT NULL,
  `codcurso` char(8) NOT NULL,
  `codprofesor` char(8) NOT NULL,
  `codAula` char(8) NOT NULL,
  `dia_semana` enum('Lunes','Martes','Miércoles','Jueves','Viernes','Sábado','Domingo') NOT NULL,
  `turno` enum('Mañana','Tarde','Noche') NOT NULL,
  `hora_inicio` time NOT NULL,
  `hora_fin` time NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE `matricula` (
  `codmatricula` int(11) NOT NULL,
  `codprofesor` char(8) NOT NULL,
  `codalumno` char(8) NOT NULL,
  `codcurso` char(8) NOT NULL,
  `modalidad` enum('presencial','semi-presencial','virtual') NOT NULL,
  `fecha_de_matricula` date DEFAULT NULL,
  `codPeriodo` int(8) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `nota` (
  `idnota` int(11) NOT NULL,
  `codmatricula` int(11) NOT NULL,
  `nota1` decimal(5,2) NOT NULL COMMENT '5% del promedio',
  `nota2` decimal(5,2) NOT NULL COMMENT '20% del promedio',
  `nota3` decimal(5,2) NOT NULL COMMENT '20% del promedio',
  `nota4` decimal(5,2) NOT NULL COMMENT '15% del promedio',
  `nota_proyecto` decimal(5,2) NOT NULL COMMENT '40% del promedio',
  `promedio` decimal(5,2) GENERATED ALWAYS AS (round(`nota1` * 0.05 + `nota2` * 0.20 + `nota3` * 0.20 + `nota4` * 0.15 + `nota_proyecto` * 0.40,2)) STORED COMMENT 'calculado automáticamente'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `pagos` (
  `codPago` int(11) NOT NULL,
  `codmatricula` int(11) NOT NULL COMMENT 'Código de matrícula del alumno',
  `tipoPago` enum('Matrícula','Pensión 1','Pensión 2','Pensión 3','Pensión 4','Pensión 5') NOT NULL COMMENT 'Tipo de pago',
  `monto` decimal(10,2) NOT NULL COMMENT 'Monto del pago',
  `fechaPago` date DEFAULT NULL COMMENT 'Fecha cuando se realizó el pago (NULL si no se ha pagado)',
  `fechaVencimiento` date NOT NULL COMMENT 'Fecha límite de pago',
  `estado` enum('Pendiente','Pagado','Vencido','Cancelado') DEFAULT 'Pendiente' COMMENT 'Estado del pago',
  `metodoPago` enum('Efectivo','Transferencia','Tarjeta','Depósito','Otro') DEFAULT NULL COMMENT 'Método de pago (si aplica)',
  `referenciaPago` varchar(50) DEFAULT NULL COMMENT 'Número de referencia o comprobante'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;



CREATE TABLE `periodo` (
  `codPeriodo` int(11) NOT NULL,
  `NombrePeriodo` char(100) DEFAULT NULL,
  `anio` int(11) NOT NULL,
  `codCiclo` char(8) NOT NULL,
  `fecha_inicio_matricula` date DEFAULT NULL,
  `fecha_fin_matricula` date DEFAULT NULL,
  `fechaInicio` date NOT NULL,
  `fechaFin` date NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;



CREATE TABLE `profesor` (
  `codprofesor` char(8) NOT NULL,
  `nombreprofesor` varchar(100) NOT NULL,
  `apaternoprofesor` varchar(100) NOT NULL,
  `amaternoprofesor` varchar(100) NOT NULL,
  `titulo_academico` enum('Doctorado','Maestría','Título Profesional','Bachillerato') NOT NULL,
  `correo` varchar(100) NOT NULL,
  `telefono` varchar(15) DEFAULT NULL,
  `direccion` varchar(250) DEFAULT NULL,
  `fecha_contratacion` date NOT NULL,
  `salario` decimal(10,2) NOT NULL,
  `departamento` varchar(100) NOT NULL,
  `estado` enum('Activo','Inactivo') DEFAULT 'Activo',
  `fecha_nacimiento` date DEFAULT NULL,
  `fecha_salida` date DEFAULT NULL,
  `motivo_salida` enum('Despido','Renuncia','Jubilación','Otro') DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE `registro_acceso` (
  `id` int(11) NOT NULL,
  `codalumno` int(11) NOT NULL,
  `fecha` date NOT NULL COMMENT 'Fecha del registro (sin hora)',
  `hora_inicio` time NOT NULL COMMENT 'Hora de inicio de sesión (HH:MM:SS)',
  `hora_fin` time NOT NULL COMMENT 'Hora de fin de sesión (HH:MM:SS)',
  `ip` varchar(15) NOT NULL COMMENT 'IP del despositivo ',
  `latitud` decimal(10,8) DEFAULT NULL COMMENT 'Latitud con 8 decimales de precisión',
  `longitud` decimal(11,8) DEFAULT NULL COMMENT 'Longitud con 8 decimales de precisión',
  `duracion_min` int(11) GENERATED ALWAYS AS (timestampdiff(MINUTE,timestamp(`fecha`,`hora_inicio`),timestamp(`fecha`,`hora_fin`))) STORED COMMENT 'Duración en minutos (calculada automáticamente)'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `sede` (
  `codSede` int(11) NOT NULL,
  `nombreSede` varchar(5100) NOT NULL,
  `direccion` varchar(250) DEFAULT NULL,
  `departamento` varchar(50) DEFAULT NULL,
  `provincia` varchar(50) DEFAULT NULL,
  `distrito` varchar(50) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE `usuario` (
  `codalumno` char(8) NOT NULL,
  `password` varchar(60) NOT NULL,
  `qr_alumno` varchar(100) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


--
ALTER TABLE `alumno`
  ADD PRIMARY KEY (`codalumno`),
  ADD KEY `fk_alumno_sede` (`codSede`),
  ADD KEY `codAula` (`codAula`);

--
-- Indices de la tabla `alumno_horario`
--
ALTER TABLE `alumno_horario`
  ADD PRIMARY KEY (`codalumno`,`codhorario`),
  ADD UNIQUE KEY `unique_alumno_horario` (`codalumno`,`codhorario`),
  ADD KEY `codhorario` (`codhorario`);

--
-- Indices de la tabla `aula_laboratorio`
--
ALTER TABLE `aula_laboratorio`
  ADD PRIMARY KEY (`codAula`),
  ADD KEY `codSede` (`codSede`);

--
-- Indices de la tabla `ciclo`
--
ALTER TABLE `ciclo`
  ADD PRIMARY KEY (`codCiclo`);

--
-- Indices de la tabla `curso`
--
ALTER TABLE `curso`
  ADD PRIMARY KEY (`codcurso`),
  ADD KEY `codprofesor` (`codprofesor`),
  ADD KEY `codPeriodo` (`codPeriodo`);

--
-- Indices de la tabla `horarios_disponibles`
--
ALTER TABLE `horarios_disponibles`
  ADD PRIMARY KEY (`codhorario`),
  ADD KEY `codcurso` (`codcurso`),
  ADD KEY `codprofesor` (`codprofesor`),
  ADD KEY `idx_codhorario` (`codhorario`),
  ADD KEY `codAula` (`codAula`);

--
-- Indices de la tabla `matricula`
--
ALTER TABLE `matricula`
  ADD PRIMARY KEY (`codmatricula`),
  ADD KEY `codprofesor` (`codprofesor`),
  ADD KEY `codalumno` (`codalumno`),
  ADD KEY `codcurso` (`codcurso`),
  ADD KEY `codPeriodo` (`codPeriodo`);

--
-- Indices de la tabla `nota`
--
ALTER TABLE `nota`
  ADD PRIMARY KEY (`idnota`),
  ADD KEY `idx_matricula` (`codmatricula`),
  ADD KEY `idx_promedio` (`promedio`);

--
-- Indices de la tabla `pagos`
--
ALTER TABLE `pagos`
  ADD PRIMARY KEY (`codPago`),
  ADD KEY `idx_matricula` (`codmatricula`),
  ADD KEY `idx_vencimiento` (`fechaVencimiento`),
  ADD KEY `idx_estado` (`estado`);

--
-- Indices de la tabla `periodo`
--
ALTER TABLE `periodo`
  ADD PRIMARY KEY (`codPeriodo`),
  ADD UNIQUE KEY `anio` (`anio`,`codCiclo`),
  ADD UNIQUE KEY `UC_Periodo_Unico` (`anio`,`codCiclo`);

--
-- Indices de la tabla `profesor`
--
ALTER TABLE `profesor`
  ADD PRIMARY KEY (`codprofesor`),
  ADD UNIQUE KEY `correo` (`correo`);

--
-- Indices de la tabla `registro_acceso`
--
ALTER TABLE `registro_acceso`
  ADD PRIMARY KEY (`id`),
  ADD KEY `idx_alumno` (`codalumno`),
  ADD KEY `idx_fecha` (`fecha`),
  ADD KEY `idx_hora` (`hora_inicio`),
  ADD KEY `idx_gps` (`latitud`,`longitud`),
  ADD KEY `idx_duracion` (`duracion_min`);

--
-- Indices de la tabla `sede`
--
ALTER TABLE `sede`
  ADD PRIMARY KEY (`codSede`);

--
-- Indices de la tabla `usuario`
--
ALTER TABLE `usuario`
  ADD PRIMARY KEY (`codalumno`),
  ADD KEY `codalumno` (`codalumno`);

--
-- AUTO_INCREMENT de las tablas volcadas
--

--
-- AUTO_INCREMENT de la tabla `matricula`
--
ALTER TABLE `matricula`
  MODIFY `codmatricula` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=166;

--
-- AUTO_INCREMENT de la tabla `nota`
--
ALTER TABLE `nota`
  MODIFY `idnota` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=47;

--
-- AUTO_INCREMENT de la tabla `pagos`
--
ALTER TABLE `pagos`
  MODIFY `codPago` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=25;

--
-- AUTO_INCREMENT de la tabla `periodo`
--
ALTER TABLE `periodo`
  MODIFY `codPeriodo` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=5;

--
-- AUTO_INCREMENT de la tabla `registro_acceso`
--
ALTER TABLE `registro_acceso`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=21;

--
-- AUTO_INCREMENT de la tabla `sede`
--
ALTER TABLE `sede`
  MODIFY `codSede` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=6;

--
-- Restricciones para tablas volcadas
--

--
-- Filtros para la tabla `alumno`
--
ALTER TABLE `alumno`
  ADD CONSTRAINT `fk_alumno_sede` FOREIGN KEY (`codSede`) REFERENCES `sede` (`codSede`) ON DELETE SET NULL ON UPDATE CASCADE;

--
-- Filtros para la tabla `alumno_horario`
--
ALTER TABLE `alumno_horario`
  ADD CONSTRAINT `alumno_horario_ibfk_1` FOREIGN KEY (`codalumno`) REFERENCES `alumno` (`codalumno`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `alumno_horario_ibfk_2` FOREIGN KEY (`codhorario`) REFERENCES `horarios_disponibles` (`codhorario`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Filtros para la tabla `aula_laboratorio`
--
ALTER TABLE `aula_laboratorio`
  ADD CONSTRAINT `aula_laboratorio_ibfk_1` FOREIGN KEY (`codSede`) REFERENCES `sede` (`codSede`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Filtros para la tabla `curso`
--
ALTER TABLE `curso`
  ADD CONSTRAINT `curso_ibfk_1` FOREIGN KEY (`codprofesor`) REFERENCES `profesor` (`codprofesor`) ON DELETE SET NULL ON UPDATE CASCADE,
  ADD CONSTRAINT `curso_ibfk_2` FOREIGN KEY (`codPeriodo`) REFERENCES `periodo` (`codPeriodo`) ON DELETE SET NULL ON UPDATE CASCADE;

--
-- Filtros para la tabla `horarios_disponibles`
--
ALTER TABLE `horarios_disponibles`
  ADD CONSTRAINT `horarios_disponibles_ibfk_1` FOREIGN KEY (`codcurso`) REFERENCES `curso` (`codcurso`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `horarios_disponibles_ibfk_2` FOREIGN KEY (`codprofesor`) REFERENCES `profesor` (`codprofesor`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Filtros para la tabla `matricula`
--
ALTER TABLE `matricula`
  ADD CONSTRAINT `matricula_ibfk_1` FOREIGN KEY (`codprofesor`) REFERENCES `profesor` (`codprofesor`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `matricula_ibfk_2` FOREIGN KEY (`codalumno`) REFERENCES `alumno` (`codalumno`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `matricula_ibfk_3` FOREIGN KEY (`codcurso`) REFERENCES `curso` (`codcurso`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `matricula_ibfk_4` FOREIGN KEY (`codPeriodo`) REFERENCES `periodo` (`codPeriodo`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Filtros para la tabla `nota`
--
ALTER TABLE `nota`
  ADD CONSTRAINT `nota_ibfk_1` FOREIGN KEY (`codmatricula`) REFERENCES `matricula` (`codmatricula`);

--
-- Filtros para la tabla `pagos`
--
ALTER TABLE `pagos`
  ADD CONSTRAINT `pagos_ibfk_1` FOREIGN KEY (`codmatricula`) REFERENCES `matricula` (`codmatricula`) ON DELETE CASCADE;
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
